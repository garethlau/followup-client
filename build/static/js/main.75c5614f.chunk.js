(this["webpackJsonpmail-client"]=this["webpackJsonpmail-client"]||[]).push([[0],{10:function(e,t,a){e.exports={BASE_URL:"https://followup.api.garethdev.space"}},119:function(e,t,a){e.exports=a(180)},124:function(e,t,a){},179:function(e,t,a){},180:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(19),c=a.n(l),o=a(7),i=a(24),s=a(31);a(124);function u(){return r.a.createElement("div",null,"Emaily")}var m=a(185),d=a(30),p=a(9),h=a.n(p),g=a(10),v=a(26),E={user:null},f=Object(n.createContext)(E),b=f.Provider,x=function(e){var t=e.children,a=Object(n.useReducer)((function(e,t){switch(console.log(t),t.type){case y.SET_USER:return Object(v.a)(Object(v.a)({},e),{},{user:t.payload});case y.CLEAR_USER:return Object(v.a)(Object(v.a)({},e),{},{user:null});default:throw new Error}}),E),l=Object(o.a)(a,2),c=l[0],i=l[1];return r.a.createElement(b,{value:{state:c,dispatch:i}},t)},y={SET_USER:"SET_USER",CLEAR_USER:"CLEAR_USER"},w=function(e){var t=Object(n.useState)(e),a=Object(o.a)(t,2),r=a[0],l=a[1],c=Object(n.useState)(!1),i=Object(o.a)(c,2),s=i[0],u=i[1],m=Object(n.useState)(""),d=Object(o.a)(m,2),p=d[0],h=d[1];function g(){u(!1),h("")}return{value:r,setValue:l,onChange:function(e){g(),l(e.target.value)},clear:function(){l("")},hasError:s,helperText:p,setError:function(e){u(!0),h(e)},clearError:g}};function C(){var e=Object(s.g)().orgName,t=Object(n.useState)([]),a=Object(o.a)(t,2),l=a[0],c=a[1],i=Object(s.f)(),u=Object(n.useContext)(f).state,p=w(""),v=Object(n.useState)(!0),E=Object(o.a)(v,2),b=E[0],x=E[1],y=Object(n.useState)(!1),C=Object(o.a)(y,2),O=C[0],S=C[1],j=function(e){var t=Object(n.useState)(e),a=Object(o.a)(t,2),r=a[0],l=a[1];return{value:r,onChange:function(e){l(e.currentTarget.value)}}}("Modified Date - ASC");Object(n.useEffect)((function(){h.a.get("".concat(g.BASE_URL,"/api/v1/organization/").concat(e,"/drafts")).then((function(e){c(e.data.drafts),S(!0)})).catch((function(e){console.log(e.message),S(!1)})).finally((function(){x(!1)}))}),[e]);var R;return b?r.a.createElement("div",{style:{width:"min-content",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},r.a.createElement(m.t,{intent:d.a.PRIMARY})):O?r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement("div",{style:{width:"250px",marginBottom:"20px"}},r.a.createElement(m.f,null,r.a.createElement(m.l,{onChange:function(e){p.onChange(e)},value:p.value,placeholder:"I'm looking for..."}),r.a.createElement(m.i,{options:["Send Date - ASC","Send Date - DESC","Modified Date - ASC","Modified Date - DESC"],onChange:j.onChange,value:j.value}))),r.a.createElement("div",{style:{overflow:"auto"}},r.a.createElement(m.j,{bordered:!0,interactive:!0},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{style:{minWidth:"150px"}},"Creator"),r.a.createElement("th",{style:{minWidth:"100px"}},"Versions"),r.a.createElement("th",{style:{minWidth:"100px"}},"Send Date"),r.a.createElement("th",{style:{minWidth:"250px"}},"To"),r.a.createElement("th",{style:{minWidth:"250px"}},"Subject"),r.a.createElement("th",{style:{minWidth:"125px"}},"Last Modified"),r.a.createElement("th",{style:{minWidth:"250px"}},"Latest Commit Message"),r.a.createElement("th",{style:{minWidth:"250px"}},"Tags"),r.a.createElement("th",{style:{minWidth:"150px"}},"Reviewers"),r.a.createElement("th",{style:{minWidth:"150px"}},"Approvals"),r.a.createElement("th",{style:{minWidth:"100px"}},"Status"))),r.a.createElement("tbody",null,l.sort((function(e,t){var a=e.versions.length>0?e.versions[e.versions.length-1]:null,n=t.versions.length>0?t.versions[t.versions.length-1]:null;return"Modified Date - ASC"===j.value?a||n?n?a?a.modifiedDate>=n.modifiedDate?-1:1:-1:1:0:"Modified Date - DESC"===j.value?a||n?n?a?a.modifiedDate>=n.modifiedDate?1:-1:1:-1:0:"Send Date - ASC"===j.value?a||n?n?a?a.sendDate>=n.sendDate?-1:1:-1:1:0:"Send Date - DESC"===j.value?a||n?n?a?a.sendDate>=n.sendDate?1:-1:1:-1:0:void 0})).map((function(t){var a,n=t.versions.length>0?t.versions[t.versions.length-1]:null;return function(e){var t=e.versions.length>0?e.versions[e.versions.length-1]:null;function a(e){return e.toLowerCase().includes(p.value.toLowerCase())}return t&&t.tags.some(a)||t&&t.subject.toLowerCase().includes(p.value.toLowerCase())||t&&t.to.some(a)||t&&t.commitMessage.toLowerCase().includes(p.value.toLowerCase())||e.creator.firstName.toLowerCase().includes(p.value.toLowerCase())}(t)?r.a.createElement("tr",{onClick:(a=t._id,function(){i.push("/".concat(e,"/compose?draftId=").concat(a))}),key:t._id},r.a.createElement("td",null,t.creator.firstName+" "+t.creator.lastName),r.a.createElement("td",{style:{textAlign:"center"}},t.versions.length),r.a.createElement("td",null,n&&new Date(n.sendDate).toLocaleDateString()),r.a.createElement("td",null,n&&n.to.map((function(e,t){return r.a.createElement(m.u,{minimal:!0,key:t,style:{margin:"0px 5px 5px 0px"}},e)}))),r.a.createElement("td",null,n?n.subject:""),r.a.createElement("td",{style:{textAlign:"center"}},n?new Date(parseInt(n.modifiedDate)).toLocaleDateString():"N/A"),r.a.createElement("td",null,n&&n.commitMessage),r.a.createElement("td",null,n&&n.tags.map((function(e,t){return r.a.createElement(m.u,{minimal:!0,key:t,style:{margin:"0px 5px 5px 0px"}},e)}))),r.a.createElement("td",null,t.reviewers.map((function(e){return r.a.createElement(m.u,{key:e.id,style:{margin:"0px 5px 5px 0px"},intent:e.approved?d.a.SUCCESS:d.a.DANGER,minimal:!u.user||e.id!==u.user._id},e.firstName[0]+e.lastName[0])}))),r.a.createElement("td",{style:{textAlign:"center"}},t.reviewers.reduce((function(e,t){return t.approved&&e++,e}),0),"/ ",t.reviewers.length),r.a.createElement("td",null,t.sent?"Sent":"Not Sent")):null})))))):r.a.createElement("div",{style:{width:"min-content",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},r.a.createElement(m.c,{icon:"disable",title:"Not authorized"},r.a.createElement("div",{style:{width:"350px"}},u.user?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"You're not a member of this organization. Want in? Ask for access or switch to an account with permission."),r.a.createElement("p",null,"Currently logged in as:"," ",r.a.createElement(m.e,{style:{marginLeft:"5px"}},u.user.username)),r.a.createElement(m.b,{intent:d.a.PRIMARY,text:"Request Access",disabled:!0})):r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:{width:"350px"}},"You're currently not logged in. You must be logged in to continue."," "),r.a.createElement(m.b,{intent:d.a.PRIMARY,onClick:(R="/login?redirect=/".concat(e,"/dashboard"),function(){i.push(R)}),text:"Log in"})))))}var O=a(8),S=a.n(O),j=a(13);var R=a(1),A=a(187),k=a(21),N=a.n(k),T=a(17),L=m.x.create({className:"recipe-toaster",position:T.a.TOP});function D(e){var t=e.updated,a=e.setUpdated,l=e.isOpen,c=e.setIsOpen,i=e.members,s=e.reviewers,u=(A.a,Object(n.useState)([])),p=Object(o.a)(u,2),E=p[0],f=p[1];function b(){return(b=Object(j.a)(S.a.mark((function e(){var n,r,l;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={reviewerIds:JSON.stringify(E.filter((function(e){return e.checked})).map((function(e){return e._id})))},r=N.a.searchToJSON(window.location.search),l=r.draftId,e.prev=2,e.next=5,h.a.post("".concat(g.BASE_URL,"/api/v1/draft/").concat(l,"/reviewer"),n);case 5:e.sent,c(!1),L.show({message:"Succesfully updated reviewers",intent:d.a.SUCCESS}),a(t+1),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),L.show({message:e.t0.message,intent:d.a.DANGER});case 14:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}return Object(n.useEffect)((function(){f(i.map((function(e){return Object(v.a)(Object(v.a)({},e),{},{checked:s.map((function(e){return e.id})).includes(e._id)})})))}),[s,i]),r.a.createElement(m.g,{isOpen:l,usePortal:!0,canEscapeKeyClose:!0,title:"Add reviewer",onClose:function(){return c(!1)}},r.a.createElement("div",{className:R.a.DIALOG_BODY},E.map((function(e){return r.a.createElement(m.d,{label:"".concat(e.firstName," ").concat(e.lastName),checked:e.checked,onChange:(t=e._id,function(e){var a=E.map((function(a){return a._id===t&&(a.checked=e.target.checked),a}));f(a)})});var t}))),r.a.createElement("div",{className:R.a.DIALOG_FOOTER},r.a.createElement("div",{className:R.a.DIALOG_FOOTER_ACTIONS},r.a.createElement(m.b,{onClick:function(){return c(!1)}},"Close"),r.a.createElement(m.a,{onClick:function(){return b.apply(this,arguments)},intent:d.a.PRIMARY},"Save"))))}var I=a(186),_=a(87);function U(e){var t=Object(n.useState)(e||[]),a=Object(o.a)(t,2),r=a[0],l=a[1];return{values:r,clear:function(){l([])},set:function(e){l(e)},add:function(e){l([].concat(Object(_.a)(r),[e]))},onChange:function(e){l(e)}}}var B=a(46),M=a.n(B);function P(){var e=Object(n.useContext)(f).state,t=function(e,t,a){var r=e.map((function(e){return window.matchMedia(e)})),l=function(){var e=r.findIndex((function(e){return e.matches}));return"undefined"!==typeof t[e]?t[e]:a},c=Object(n.useState)(l),i=Object(o.a)(c,2),s=i[0],u=i[1];return Object(n.useEffect)((function(){var e=function(){return u(l)};return r.forEach((function(t){return t.addListener(e)})),function(){return r.forEach((function(t){return t.removeListener(e)}))}}),[]),s}(["(min-width: 550px)"],[2],1),a=Object(s.f)(),l=Object(s.g)().orgName,c=Object(n.useState)(0),i=Object(o.a)(c,2),u=i[0],p=i[1],E=Object(n.useState)([]),b=Object(o.a)(E,2),x=b[0],y=b[1],C=w(""),O=w(""),R=function(e){var t=Object(n.useState)(e||null),a=Object(o.a)(t,2),r=a[0],l=a[1];return{value:r,onChange:function(e){l(e)},set:function(e){l(new Date(e))},clear:function(){l(null)}}}(new Date),A=w(""),k=U(),_=U(),P=U(),z=U(),G=Object(n.useState)(M.a.createEmptyValue()),Y=Object(o.a)(G,2),J=Y[0],W=Y[1],F=Object(n.useState)({}),V=Object(o.a)(F,2),q=V[0],H=V[1],K=Object(n.useState)(!1),$=Object(o.a)(K,2),Q=$[0],X=$[1],Z=Object(n.useState)("v0"),ee=Object(o.a)(Z,2),te=ee[0],ae=ee[1],ne=w(""),re=Object(n.useState)([]),le=Object(o.a)(re,2),ce=le[0],oe=le[1],ie=Object(n.useState)(!1),se=Object(o.a)(ie,2),ue=se[0],me=se[1];function de(e){C.setValue(e.subject),R.set(e.sendDate),k.set(e.to),_.set(e.cc),P.set(e.bcc),z.set(e.tags),O.setValue(e.from),A.setValue(e.commitMessage),W(B.EditorValue.createFromString(e.body,"html"))}function pe(){return(pe=Object(j.a)(S.a.mark((function e(){var t,n,r;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={subject:C.value,sendDate:R.value,to:k.values,cc:_.values,bcc:P.values,body:J.toString("html"),tags:z.values,commitMessage:A.value},n=N.a.searchToJSON(window.location.search),r=n.draftId,e.prev=2,e.next=5,h.a.post("".concat(g.BASE_URL,"/api/v1/draft/").concat(r,"/version"),t);case 5:L.show({message:"Draft saved",action:{onClick:function(){return a.push("/".concat(l,"/dashboard"))},text:"Go to dashboard"},intent:d.a.SUCCESS}),p(u+1),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0),L.show({message:e.t0.message,intent:d.a.DANGER});case 13:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function he(){return(he=Object(j.a)(S.a.mark((function e(){var t,a,n,r;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={content:ne.value,version:te},a=N.a.searchToJSON(window.location.search),n=a.draftId,e.prev=2,e.next=5,h.a.post("".concat(g.BASE_URL,"/api/v1/draft/").concat(n,"/comment"),t);case 5:r=e.sent,ne.clear(),oe(r.data.comments),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}Object(n.useEffect)((function(){var e=N.a.searchToJSON(window.location.search);e.draftId&&h.a.get("".concat(g.BASE_URL,"/api/v1/draft/").concat(e.draftId)).then((function(e){var t=e.data.draft;H(t);for(var a=t.versions.length,n=[],r=1;r<=a;r++)n.push("v".concat(r));y(n),ae("v".concat(a)),X(!0),de(t.versions[t.versions.length-1]),oe(t.comments)})).catch((function(e){console.log(e)}))}),[u]);var ge=Object(n.useState)([]),ve=Object(o.a)(ge,2),Ee=ve[0],fe=ve[1];function be(){return xe.apply(this,arguments)}function xe(){return(xe=Object(j.a)(S.a.mark((function e(){var t,a;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=N.a.searchToJSON(window.location.search),a=t.draftId,e.prev=1,e.next=4,h.a.post("".concat(g.BASE_URL,"/api/v1/draft/").concat(a,"/approve"));case 4:L.show({message:"You've approved this draft",intent:d.a.SUCCESS}),p(u+1),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0.message),L.show({message:e.t0.message,intent:d.a.DANGER});case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function ye(){return we.apply(this,arguments)}function we(){return(we=Object(j.a)(S.a.mark((function e(){var t,a;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=N.a.searchToJSON(window.location.search),a=t.draftId,e.prev=1,e.next=4,h.a.post("".concat(g.BASE_URL,"/api/v1/draft/").concat(a,"/reject"));case 4:L.show({message:"You've rejected this draft",intent:d.a.SUCCESS}),p(u+1),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0.message),L.show({message:e.t0.message,intent:d.a.DANGER});case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}Object(n.useEffect)((function(){h.a.get("".concat(g.BASE_URL,"/api/v1/organization/").concat(l,"/users")).then((function(e){fe(e.data.users.concat(e.data.admins))})).catch((function(e){console.log(e)}))}),[l]);var Ce={display:"grid",gridTemplateColumns:2===t?"1fr 1fr":"1fr",gridTemplateRows:2===t?"1fr":"auto auto"},Oe={width:"250px",marginBottom:"10px"};return r.a.createElement("div",{style:Ce},r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement("div",{style:{border:"solid 1px lightgrey",padding:"20px"}},r.a.createElement("h1",null,"Reviewers"),r.a.createElement(m.h,null),q.reviewers&&q.reviewers.length>0?q.reviewers.map((function(t){return r.a.createElement("div",{style:{display:"grid",gridTemplateColumns:"24px 150px 1fr 150px 100px",columnGap:"10px",gridTemplateRows:"24px",margin:"10px 0px",padding:"0px 10px"}},r.a.createElement("div",null,r.a.createElement("img",{style:{borderRadius:"50%",width:"20px",height:"20px",margin:"2px"},src:"https://www.w3schools.com/howto/img_avatar.png",alt:"profile"})),r.a.createElement("div",{style:{display:"table",height:"24px"}},r.a.createElement("div",{style:{display:"table-cell",verticalAlign:"middle"}},t.firstName+" "+t.lastName)),r.a.createElement("div",null),r.a.createElement("div",{style:{display:"table",height:"24px"}},r.a.createElement("div",{style:{display:"table-cell",verticalAlign:"middle"}},t.approved?r.a.createElement("div",{style:{textAlign:"center"}},"Approved"):r.a.createElement("div",{style:{textAlign:"center"}},"Not Approved"))),r.a.createElement("div",{style:{display:"table",height:"24px"}},r.a.createElement("div",{style:{display:"table-cell",verticalAlign:"middle"}},e.user&&t.id===e.user._id?t.approved?r.a.createElement(m.b,{text:"Reject",onClick:ye,intent:d.a.DANGER,small:!0}):r.a.createElement(m.b,{text:"Approve",onClick:be,intent:d.a.SUCCESS,small:!0}):null)))})):"No assigned reviewers.",r.a.createElement(m.h,null),r.a.createElement("div",{style:{textAlign:"right",marginTop:"10px"}},r.a.createElement(m.b,{intent:d.a.PRIMARY,onClick:function(){return me(!0)},text:"Manage Reviewers"}),r.a.createElement(D,{updated:u,setUpdated:p,reviewers:q.reviewers||[],members:Ee,isOpen:ue,setIsOpen:me}))),r.a.createElement("div",{style:{border:"solid 1px lightgrey",padding:"20px",marginTop:"20px"}},r.a.createElement("h1",null,"Comments"),r.a.createElement(m.h,null),0===ce.length?"No comments":ce.map((function(e){return r.a.createElement("div",{style:{display:"grid",gridTemplateAreas:"'pfp name-date version' 'pfp body version' '. body .' ",gridTemplateColumns:"48px 1fr 48px",gridTemplateRows:"24px 24px auto",marginTop:"10px",columnGap:"10px"}},r.a.createElement("div",{style:{gridArea:"pfp"}},r.a.createElement("img",{style:{borderRadius:"50%",width:"40px",height:"40px",margin:"4px"},src:"https://www.w3schools.com/howto/img_avatar.png",alt:"profile"})),r.a.createElement("div",{style:{gridArea:"name-date"}},e.author.firstName," ",e.author.lastName," -"," ",new Date(parseInt(e.date)).toLocaleDateString()),r.a.createElement("div",{style:{gridArea:"version"}}," ",e.version),r.a.createElement("div",{style:{gridArea:"body"}},e.content))})),r.a.createElement(m.h,null),r.a.createElement(m.w,{style:{marginTop:"10px"},growVertically:!0,intent:d.a.PRIMARY,fill:!0,placeholder:"Comment...",value:ne.value,onChange:ne.onChange}),r.a.createElement("div",{style:{marginTop:"10px",textAlign:"right"}},r.a.createElement(m.b,{text:"Comment",onClick:function(){return he.apply(this,arguments)},intent:d.a.PRIMARY})))),r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement("div",{style:{border:"solid 1px lightgrey",padding:"20px"}},r.a.createElement("div",null,r.a.createElement(m.i,{onChange:function(e){ae(e.currentTarget.value);var t=e.currentTarget.value.substring(1)-1,a=q.versions[t];t+1===q.versions.length?X(!0):X(!1),de(a)},style:{marginBottom:"10px"},options:x,value:te})),r.a.createElement(m.l,{style:Oe,value:C.value,onChange:C.onChange,placeholder:"Subject",disabled:!Q}),r.a.createElement("div",{style:Oe},r.a.createElement(I.a,{fill:!0,formatDate:function(e){return e.toLocaleDateString()},parseDate:function(e){return new Date(e)},value:R.value,placeholder:"Send Date",onChange:R.onChange,popoverProps:{position:T.a.BOTTOM},disabled:!Q,maxDate:new Date(1893562264171)})),r.a.createElement(m.l,{value:O.value,onChange:O.onChange,style:Oe,placeholder:"From",disabled:!Q}),r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement(m.v,{placeholder:"To",values:k.values,onChange:k.onChange,rightElement:k.values.length>0?r.a.createElement(m.b,{onClick:function(){return k.clear()},icon:"cross",minimal:!0}):null,addOnBlur:!0,tagProps:{minimal:!0},disabled:!Q})),r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement(m.v,{placeholder:"Cc",values:_.values,onChange:_.onChange,rightElement:_.values.length>0?r.a.createElement(m.b,{onClick:function(){return _.clear()},icon:"cross",minimal:!0}):null,addOnBlur:!0,tagProps:{minimal:!0},disabled:!Q})),r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement(m.v,{placeholder:"Bcc",values:P.values,onChange:P.onChange,rightElement:P.values.length>0?r.a.createElement(m.b,{onClick:function(){return P.clear()},icon:"cross",minimal:!0}):null,addOnBlur:!0,tagProps:{minimal:!0},disabled:!Q})),r.a.createElement(M.a,{editorClassName:"email-body-editor",placeholder:"Body...",style:{minHeight:"400px"},spellCheck:!0,onChange:function(e){W(e)},value:J,disabled:!Q}),r.a.createElement("div",{style:Object(v.a)(Object(v.a)({marginTop:"10px"},Oe),{},{width:"auto"})},r.a.createElement(m.v,{placeholder:"Add tags to identify this email",leftIcon:"tag",rightElement:z.values.length>0?r.a.createElement(m.b,{onClick:function(){return z.clear()},icon:"cross",minimal:!0}):null,values:z.values,onChange:z.onChange,addOnBlur:!0,tagProps:{minimal:!0},disabled:!Q})),r.a.createElement(m.l,{rightElement:r.a.createElement(m.b,{onClick:function(){return pe.apply(this,arguments)},intent:d.a.PRIMARY,text:"Save as v".concat(x.length+1),disabled:!Q}),placeholder:"Commit message",leftIcon:"info-sign",value:A.value,onChange:A.onChange,disabled:!Q}))))}var z="";function G(e){z=e}function Y(){var e=Object(n.useContext)(f).dispatch,t=w(""),a=w(""),l=Object(s.f)(),c=Object(n.useState)(!1),i=Object(o.a)(c,2),u=i[0],p=i[1];function v(){return(v=Object(j.a)(S.a.mark((function n(){var r,c,o,i,s,u,m;return S.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=null;try{c=N.a.searchToJSON(l.location.search),r=c.redirect||"/create"}catch(p){r="/create"}return o={username:t.value,password:a.value},n.prev=3,n.next=6,h.a.post(g.BASE_URL+"/api/v1/auth/login",o,{withCredentials:!0});case 6:i=n.sent,s=i.data,u=s.accessToken,m=s.user,u?(G(u),e({type:y.SET_USER,payload:m}),l.push(r)):console.log("Invalid login"),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(3),console.log(n.t0.message),n.t0.response&&(console.log(n.t0.response.status),404===n.t0.response.status?L.show({message:"User does not exist.",intent:d.a.DANGER}):401===n.t0.response.status?L.show({message:"Incorrect password.",intent:d.a.DANGER}):L.show({message:"There was an error. Please try again.",intent:d.a.DANGER}));case 15:case"end":return n.stop()}}),n,null,[[3,11]])})))).apply(this,arguments)}var E=r.a.createElement(m.y,{content:"".concat(u?"Hide":"Show"," Password")},r.a.createElement(m.b,{icon:u?"unlock":"lock",intent:d.a.WARNING,minimal:!0,onClick:function(){p(!u)}}));return r.a.createElement("div",null,r.a.createElement("div",{style:{width:"550px",height:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"30px"}},r.a.createElement("h1",null,"Log in"),r.a.createElement(m.l,{style:{marginBottom:"20px"},placeholder:"Username",value:t.value,onChange:t.onChange}),r.a.createElement(m.l,{style:{marginBottom:"20px"},placeholder:"Password",value:a.value,onChange:a.onChange,rightElement:E,type:u?"text":"password"}),r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(m.b,{style:{marginRight:"10px"},text:"Sign up",onClick:function(){if(l.location.search){var e=N.a.searchToJSON(l.location.search).redirect;l.push("/signup?redirect=".concat(e))}else l.push("/signup")}}),r.a.createElement(m.b,{text:"Log in",onClick:function(){return v.apply(this,arguments)},intent:d.a.PRIMARY}))))}function J(){var e=Object(n.useContext)(f).dispatch,t=w(""),a=w(""),l=w(""),c=w(""),i=w(""),u=Object(s.f)(),p=Object(n.useState)(!1),v=Object(o.a)(p,2),E=v[0],b=v[1];function x(){return(x=Object(j.a)(S.a.mark((function n(){var r,o,s,m,p,v;return S.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=null;try{o=N.a.searchToJSON(u.location.search),r=o.redirect||"/create"}catch(E){r="/create"}return s={username:t.value,password:a.value,firstName:l.value,lastName:c.value,email:i.value},n.prev=3,n.next=6,h.a.post(g.BASE_URL+"/api/v1/auth/signup",s);case 6:m=n.sent,p=m.data,v=p.user,G(p.accessToken),e({type:y.SET_USER,payload:v}),u.push(r),n.next=17;break;case 13:n.prev=13,n.t0=n.catch(3),console.log(n.t0.message),n.t0.response&&422===n.t0.response.status&&L.show({message:n.t0.response.data.message,intent:d.a.DANGER});case 17:case"end":return n.stop()}}),n,null,[[3,13]])})))).apply(this,arguments)}var C=r.a.createElement(m.y,{content:"".concat(E?"Hide":"Show"," Password")},r.a.createElement(m.b,{icon:E?"unlock":"lock",intent:d.a.WARNING,minimal:!0,onClick:function(){b(!E)}})),O={marginBottom:"20px"};return r.a.createElement("div",null,r.a.createElement("div",{style:{width:"550px",height:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"30px"}},r.a.createElement("h1",null,"Sign up"),r.a.createElement(m.l,{style:O,value:l.value,onChange:l.onChange,placeholder:"First Name"}),r.a.createElement(m.l,{style:O,value:c.value,onChange:c.onChange,placeholder:"Last Name"}),r.a.createElement(m.l,{style:O,value:i.value,onChange:i.onChange,placeholder:"Email"}),r.a.createElement(m.l,{style:O,value:t.value,onChange:t.onChange,placeholder:"Username"}),r.a.createElement(m.l,{style:O,value:a.value,onChange:a.onChange,placeholder:"Password",rightElement:C,type:E?"text":"password"}),r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(m.b,{text:"Log in",onClick:function(){if(u.location.search){var e=N.a.searchToJSON(u.location.search).redirect;u.push("/login?redirect=".concat(e))}else u.push("/login")},style:{marginRight:"10px"}}),r.a.createElement(m.b,{text:"Sign up",onClick:function(){return x.apply(this,arguments)},intent:d.a.PRIMARY}))))}function W(){var e=Object(n.useContext)(f).dispatch,t=Object(s.f)(),a=w(""),l=w(""),c=w(""),i=w(""),u=w(""),p=Object(n.useState)(!1),v=Object(o.a)(p,2),E=v[0],b=v[1],x=w(""),C=Object(n.useState)(0),O=Object(o.a)(C,2),R=O[0],A=O[1];function k(){return(k=Object(j.a)(S.a.mark((function n(){var r,o,s,m,p,v,E;return S.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=null,o={username:a.value,password:i.value,email:u.value,firstName:l.value,lastName:c.value},n.prev=2,n.next=5,h.a.post("".concat(g.BASE_URL,"/api/v1/auth/signup"),o);case 5:if(s=n.sent,m=s.data.accessToken,r=s.data.user,m&&r){n.next=11;break}return L.show({message:"There was an error creating your account. Please try again later.",intent:d.a.DANGER}),n.abrupt("return");case 11:G(m),e({type:y.SET_USER,payload:r}),n.next=18;break;case 15:n.prev=15,n.t0=n.catch(2),422===n.t0.response.status&&L.show({message:n.t0.response.data.message,intent:d.a.DANGER});case 18:return p={name:x.value,admins:[r._id]},n.prev=19,n.next=22,h.a.post("".concat(g.BASE_URL,"/api/v1/organization"),p);case 22:v=n.sent,E=v.data.organization.name,L.show({message:"Your account and organization have been created. Redirecting to admin page.",intent:d.a.SUCCESS}),setTimeout((function(){t.push("".concat(E,"/admin"))}),3e3),n.next=32;break;case 28:n.prev=28,n.t1=n.catch(19),console.log(n.t1.messsage),L.show({message:"There was an error creating the organization. Please try again later.",intent:d.a.DANGER});case 32:case"end":return n.stop()}}),n,null,[[2,15],[19,28]])})))).apply(this,arguments)}var N={marginBottom:"20px"},T=function(e,t){return function(){if(console.log(e,t),0===e){var n=""===l.value.trim()?"First name cannot be blank.":""===c.value.trim()?"Last name cannot be blank.":""===u.value.trim()?"Email cannot be blank.":""===a.value.trim()?"Username cannot be blank.":""===i.value.trim()?"Password cannot be blank.":void 0;n?L.show({message:n,intent:d.a.DANGER}):A(t)}else A(t)}};var D=r.a.createElement(m.y,{content:"".concat(E?"Hide":"Show"," Password")},r.a.createElement(m.b,{icon:E?"unlock":"lock",intent:d.a.WARNING,minimal:!0,onClick:function(){b(!E)}}));return 0===R?r.a.createElement("div",null,r.a.createElement("div",{style:{width:"550px",height:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"30px"}},r.a.createElement("h1",null,"First, create an account"),r.a.createElement(m.l,{placeholder:"First Name",value:l.value,onChange:l.onChange,style:N}),r.a.createElement(m.l,{placeholder:"Last Name",value:c.value,onChange:c.onChange,style:N}),r.a.createElement(m.l,{placeholder:"Email",value:u.value,onChange:u.onChange,style:N}),r.a.createElement(m.l,{placeholder:"Username",value:a.value,onChange:a.onChange,style:N}),r.a.createElement(m.l,{placeholder:"Password",value:i.value,onChange:i.onChange,style:N,rightElement:D,type:E?"text":"password"}),r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(m.b,{intent:d.a.PRIMARY,onClick:T(0,1),text:"Next"})))):1===R?r.a.createElement("div",null,r.a.createElement("div",{style:{width:"550px",height:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"30px"}},r.a.createElement("h1",null,"Create organization"),r.a.createElement("p",null,"You will automatically added as an admin to this organization."),r.a.createElement(m.l,{placeholder:"Organization Name",value:x.value,onChange:x.onChange,style:N}),r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(m.b,{style:{marginRight:"5px"},onClick:T(1,0),text:"Go Back"}),r.a.createElement(m.b,{intent:d.a.PRIMARY,onClick:function(){return k.apply(this,arguments)},text:"Create Organization"})))):void 0}function F(){var e=Object(s.f)(),t=Object(n.useContext)(f).state,a=Object(s.g)().orgName,l=Object(n.useState)(!1),c=Object(o.a)(l,2),i=c[0],u=c[1],p=Object(n.useState)(!0),v=Object(o.a)(p,2),E=v[0],b=v[1],x=Object(n.useState)([]),y=Object(o.a)(x,2),w=y[0],C=y[1],O=Object(n.useState)([]),R=Object(o.a)(O,2),A=R[0],k=R[1];Object(n.useEffect)((function(){Object(j.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.a.get("".concat(g.BASE_URL,"/api/v1/organization/").concat(a,"/isAdmin"));case 3:if(e.sent.data.isAdmin){e.next=9;break}return b(!1),e.abrupt("return");case 9:u(!0);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),e.t0.response&&401===e.t0.response.status&&b(!1);case 15:h.a.get("".concat(g.BASE_URL,"/api/v1/organization/").concat(a,"/users")).then((function(e){C(e.data.users),k(e.data.admins)})),b(!1);case 17:case"end":return e.stop()}}),e,null,[[0,12]])})))()}),[a]);var N;return E?r.a.createElement("div",{style:{width:"min-content",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},r.a.createElement(m.t,{intent:d.a.PRIMARY})):i?r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement("h1",null,"Members"),r.a.createElement(m.j,null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"First Name"),r.a.createElement("th",null,"Last Name"),r.a.createElement("th",null,"Username"),r.a.createElement("th",null,"Email"),r.a.createElement("th",null,"Role"))),r.a.createElement("tbody",null,A.map((function(e){return r.a.createElement("tr",null,r.a.createElement("td",null,e.firstName),r.a.createElement("td",null,e.lastName),r.a.createElement("td",null,e.username),r.a.createElement("td",null,e.email),r.a.createElement("td",null,"Admin"))})),w.map((function(e){return r.a.createElement("tr",null,r.a.createElement("td",null,e.firstName),r.a.createElement("td",null,e.lastName),r.a.createElement("td",null,e.username),r.a.createElement("td",null,e.email),r.a.createElement("td",null,"Member"))}))))):r.a.createElement("div",{style:{width:"min-content",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},r.a.createElement(m.c,{icon:"disable",title:"Not authorized"},r.a.createElement("div",{style:{width:"350px"}},t.user?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"You're not an admin of this organization. If you beleive you should be, please request permissions from a current admin."),r.a.createElement("p",null,"Currently logged in as:"," ",r.a.createElement(m.e,{style:{marginLeft:"5px"}},t.user.username)),r.a.createElement(m.b,{intent:d.a.PRIMARY,text:"Request Access",disabled:!0})):r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:{width:"350px"}},"You're currently not logged in. You must be logged in to continue."," "),r.a.createElement(m.b,{intent:d.a.PRIMARY,onClick:(N="/login?redirect=/".concat(a,"/dashboard"),function(){e.push(N)}),text:"Log in"})))))}function V(){var e=Object(s.f)(),t=w("");function a(){return(a=Object(j.a)(S.a.mark((function a(){var n;return S.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(""!==t.value.trim()){a.next=3;break}return L.show({message:"Organization name cannot be blank.",intent:d.a.DANGER}),a.abrupt("return");case 3:return a.prev=3,n=t.value.replace(/ /g,"-"),a.next=7,h.a.patch("".concat(g.BASE_URL,"/api/v1/organization/").concat(n,"/users"));case 7:L.show({message:"You've sucessfully joined ".concat(n,". Redirecting to dashboard."),intent:d.a.SUCCESS}),setTimeout((function(){e.push("/".concat(n,"/dashboard"))}),3e3),a.next=14;break;case 11:a.prev=11,a.t0=a.catch(3),a.t0.response&&(404===a.t0.response.status?L.show({message:"Organization does not exist.",intent:d.a.DANGER}):401===a.t0.response.status&&L.show({message:"You need to be logged in to join an organization.",intent:d.a.DANGER,action:{onClick:function(){return e.push("/login?redirect=/join")},text:"Log in"}}));case 14:case"end":return a.stop()}}),a,null,[[3,11]])})))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("div",{style:{width:"550px",height:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"30px"}},r.a.createElement("h1",null,"Join an organization"),r.a.createElement("p",null,"Enter the organization name you want to join. "),r.a.createElement(m.l,{style:{marginBottom:"20px"},placeholder:"my-cool-organization",value:t.value.replace(/ /g,"-"),onChange:t.onChange}),r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(m.b,{intent:d.a.PRIMARY,onClick:function(){return a.apply(this,arguments)},text:"Join"}))))}var q=a(36);function H(){var e=Object(n.useContext)(f),t=e.state,a=e.dispatch,l=Object(s.f)(),c=Object(s.g)().orgName,i=Object(n.useState)([]),u=Object(o.a)(i,2),p=u[0],v=u[1],E=function(e){return function(){l.push(e)}};function b(){return(b=Object(j.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.user){e.next=12;break}return e.prev=1,e.next=4,h.a.post("".concat(g.BASE_URL,"/api/v1/auth/logout"),null);case 4:a({type:y.CLEAR_USER}),G(null),l.push("/"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function x(){return(x=Object(j.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.user){e.next=12;break}return e.prev=1,e.next=4,h.a.post("".concat(g.BASE_URL,"/api/v1/auth/logout-all"));case 4:a({type:y.CLEAR_USER}),G(null),l.push("/"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function w(){return(w=Object(j.a)(S.a.mark((function e(){var t,a,n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.a.post(g.BASE_URL+"/api/v1/draft",{orgName:c});case 3:t=e.sent,a=t.data.draft,n=a._id,l.push("/".concat(c,"/compose?draftId=").concat(n)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0.messsage);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}return Object(n.useEffect)((function(){h.a.get("".concat(g.BASE_URL,"/api/v1/user/organizations")).then((function(e){v(e.data.organizations)})).catch((function(e){console.log(e.message)}))}),[]),r.a.createElement(m.o,null,r.a.createElement(m.q,{align:q.a.LEFT},r.a.createElement(m.r,null,r.a.createElement(m.s,{modifiers:{arrow:{enabled:!1}},content:r.a.createElement(m.m,null,p.map((function(e){return e.name===c?null:r.a.createElement(m.n,{onClick:E("/".concat(e.name,"/dashboard")),key:e._id,text:e.name})})),r.a.createElement(m.h,null),r.a.createElement(m.n,{onClick:E("/create"),icon:"plus",text:"Create Organization"})),target:r.a.createElement(m.b,{text:c,rightIcon:"double-caret-vertical"}),position:T.a.BOTTOM_RIGHT,minimal:!0})),r.a.createElement(m.p,null),t.user&&r.a.createElement(r.a.Fragment,null,r.a.createElement(m.b,{onClick:E("/".concat(c,"/dashboard")),className:R.a.MINIMAL,icon:"dashboard",text:"Dashboard"}),r.a.createElement(m.b,{onClick:function(){return w.apply(this,arguments)},className:R.a.MINIMAL,icon:"application",text:"Create Draft"}))),r.a.createElement(m.q,{align:q.a.RIGHT},t.user?r.a.createElement(r.a.Fragment,null,r.a.createElement(m.b,{icon:"notifications",className:R.a.MINIMAL}),r.a.createElement(m.s,{content:r.a.createElement(m.m,null,r.a.createElement(m.n,{onClick:function(){return b.apply(this,arguments)},icon:"log-out",text:"Log out"}),r.a.createElement(m.n,{onClick:function(){return x.apply(this,arguments)},icon:"globe",text:"Log out of all devices"}),r.a.createElement(m.n,{icon:"cog",text:"Settings"})),position:T.a.BOTTOM_LEFT},r.a.createElement(m.b,{icon:"caret-down",className:R.a.MINIMAL}))):r.a.createElement(r.a.Fragment,null,r.a.createElement(m.b,{onClick:E("/signup"),className:R.a.MINIMAL,text:"Sign up"}),r.a.createElement(m.b,{onClick:E("/login"),intent:d.a.PRIMARY,rightIcon:"log-in",text:"Log in"}))))}function K(){var e=Object(s.f)(),t=w(""),a=Object(n.useContext)(f).state;function l(){return(l=Object(j.a)(S.a.mark((function n(){var r,l;return S.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a.user){n.next=3;break}return L.show({message:"You need an account to create an organization.",action:{onClick:function(){return e.push("/get-started")},text:"Get Started"},intent:d.a.DANGER}),n.abrupt("return");case 3:if(""!==t.value.trim()){n.next=6;break}return L.show({message:"Organization name cannot be blank",intent:d.a.DANGER}),n.abrupt("return");case 6:return r={name:t.value,admins:[a.user._id]},n.prev=7,n.next=10,h.a.post("".concat(g.BASE_URL,"/api/v1/organization/"),r);case 10:l=n.sent,L.show({message:"Successfully created organization. Redirecting to admin page.",intent:d.a.SUCCESS}),setTimeout((function(){e.push("/".concat(l.data.organization.name,"/admin"))}),3e3),n.next=18;break;case 15:n.prev=15,n.t0=n.catch(7),L.show({message:n.t0.message,intent:d.a.DANGER});case 18:case"end":return n.stop()}}),n,null,[[7,15]])})))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("div",{style:{width:"550px",height:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"30px"}},r.a.createElement("h1",null,"Create an organization"),r.a.createElement("p",null,"You will automatically be added as an admin to this organization."),r.a.createElement(m.l,{placeholder:"Organization Name",value:t.value,onChange:t.onChange,style:{marginBottom:"20px"}}),r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(m.b,{intent:d.a.PRIMARY,onClick:function(){return l.apply(this,arguments)},text:"Create"}))))}var $=function(){var e=Object(n.useContext)(f).dispatch,t=Object(n.useState)(!0),a=Object(o.a)(t,2),l=a[0],c=a[1];return Object(n.useEffect)((function(){h.a.post("".concat(g.BASE_URL,"/api/v1/auth/refresh-token"),null,{withCredentials:!0}).then((function(t){var a=t.data,n=a.accessToken,r=a.user;n&&r&&(G(n),e({type:y.SET_USER,payload:r}))})).catch((function(e){console.log(e.message)})).finally((function(){c(!1)}))}),[]),Object(n.useEffect)((function(){var e=setInterval((function(){h.a.post("".concat(g.BASE_URL,"/api/v1/auth/refresh-token"),null,{withCredentials:!0}).then((function(e){e.data&&e.data.accessToken&&G(e.data.accessToken)})).catch((function(e){console.log(e.message)}))}),6e5);return function(){return clearInterval(e)}}),[]),l?r.a.createElement("div",{style:{width:"min-content",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},r.a.createElement(m.t,{intent:d.a.NONE})):r.a.createElement(i.a,null,r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/",exact:!0,component:u}),r.a.createElement(s.a,{path:"/get-started",component:W}),r.a.createElement(s.a,{path:"/:orgName/admin"},r.a.createElement(H,null),r.a.createElement(F,null)),r.a.createElement(s.a,{path:"/:orgName/dashboard"},r.a.createElement(H,null),r.a.createElement(C,null)),r.a.createElement(s.a,{path:"/:orgName/compose"},r.a.createElement(H,null),r.a.createElement(P,null)),r.a.createElement(s.a,{path:"/login",component:Y}),r.a.createElement(s.a,{path:"/signup",component:J}),r.a.createElement(s.a,{path:"/join",component:V}),r.a.createElement(s.a,{path:"/create",component:K})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(175),a(176),a(177),a(178),a(179);h.a.interceptors.request.use((function(e){var t=z;return t&&(e.headers.authorization="Bearer ".concat(t)),e}),(function(e){return Promise.reject(e)})),c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(x,null,r.a.createElement($,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},21:function(e,t){e.exports={getJWT:function(){return localStorage.getItem("JWT_TOKEN")},getJWTConfig:function(){return{headers:{Authorization:"Bearer "+localStorage.getItem("JWT_TOKEN")}}},setJWT:function(e){localStorage.setItem("JWT_TOKEN",e)},searchToJSON:function(e){return JSON.parse('{"'+decodeURI(e.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}}}},[[119,1,2]]]);
//# sourceMappingURL=main.75c5614f.chunk.js.map